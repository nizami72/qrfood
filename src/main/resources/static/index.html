<!-- index.html (пользовательский интерфейс для меню и оформления заказа) -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Меню ресторана</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container py-4">
    <h2 class="mb-4">Меню</h2>
    <div id="menu-container"></div>

    <h3 class="mt-5">Ваш заказ</h3>
    <ul id="order-list" class="list-group mb-3"></ul>
    <button class="btn btn-success" onclick="submitOrder()">Отправить заказ</button>
</div>

<script>
    const restaurantId = 1; // Пример ресторана
    const tableId = 2; // Например, стол #2
    const order = [];

    async function loadMenu() {
        const res = await fetch(`/api/menu/${restaurantId}`);
        const menu = await res.json();

        const container = document.getElementById('menu-container');
        for (const menuCategory in menu) {
            const block = document.createElement('div');
            block.innerHTML = `<h4 class="mt-3">${menuCategory}</h4>`;

            menu[menuCategory].forEach(item => {
                const row = document.createElement('div');
                row.className = "d-flex justify-content-between align-items-center border p-2 mb-2";
                row.innerHTML = `
                    <div>
                        <strong>${item.name}</strong><br>
                        <small>${item.description}</small>
                    </div>
                    <div>
                        <span class="me-3">${item.price} AZN</span>
                        <button class="btn btn-sm btn-outline-primary" onclick='addToOrder(${JSON.stringify(item)})'>+</button>
                    </div>
                `;
                block.appendChild(row);
            });

            container.appendChild(block);
        }
    }

    function addToOrder(item) {
        const existing = order.find(o => o.menuItemId === item.id);
        if (existing) existing.quantity++;
        else order.push({ menuItemId: item.id, quantity: 1, note: "" });
        renderOrder();
    }

    function renderOrder() {
        const list = document.getElementById('order-list');
        list.innerHTML = "";
        order.forEach((item, i) => {
            const li = document.createElement('li');
            li.className = "list-group-item d-flex justify-content-between align-items-center";
            li.innerHTML = `
                <span>Блюдо #${item.menuItemId} × ${item.quantity}</span>
                <button class="btn btn-sm btn-danger" onclick="removeItem(${i})">Удалить</button>
            `;
            list.appendChild(li);
        });
    }

    function removeItem(index) {
        order.splice(index, 1);
        renderOrder();
    }

    async function submitOrder() {
        if (order.length === 0) return alert("Добавьте блюда в заказ");
        const res = await fetch(`/api/orders/create/${tableId}`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(order)
        });

        const result = await res.json();
        alert("Заказ отправлен! ID: " + result.id);
        order.length = 0;
        renderOrder();
    }

    loadMenu();
</script>
</body>
</html>
